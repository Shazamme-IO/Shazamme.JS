(()=>{const Version="1.0.0";const Message={submit:"screening-question-apply"};shazamme.style(`https://sdk.shazamme.io/js/plugin/screening-question/${Version}/plugin.css?_=3368`).then();shazamme.plugin={...shazamme.plugin,screeningQuestions:(w,o)=>{const sender=this;const jid=o?.jid;const tid=o?.tid;const cid=o?.cid;const config=o?.config||{};const collection=o?.collection||{};const editing=o?.editing===true;const container=o?.container||$(`<div data-rel="screening-fields"></div>`);const site=shazamme.bag("site-config");this.pageNumber=0;this.isValid=true;const nextPage=()=>{this._showQuestions(this.pageNumber+1)};const prevPage=()=>{this._showQuestions(this.pageNumber-1)};const answers=()=>{let d=[];this._recordAnswers();for(let i in this._answers){let a={...this._answers[i],candidateID:cid};if(typeof a.answerUUID==="object"&&a.answerUUID?.length>0){d.push(...a.answerUUID.map(x=>new Object({screeningQuestionID:a.screeningQuestionID,answerUUID:x,screeningTemplateID:a.screeningTemplateID,candidateID:cid})))}else{d.push(a)}}return{screeningTemplateID:this._screeningTemplateID,values:d}};const loadAnswers=id=>shazamme.site().then(s=>shazamme.submit({action:"Get Screening Answers",siteID:s.siteID,jobApplicationID:id,candidateID:cid,screeningTemplateID:tid})).then(a=>{let answers=[];let p=this._pages[this.pageNumber||0]||[];a?.response?.items?.forEach(i=>{answers[i.screeningQuestionID]=i});this._answers=answers;this._restoreAnswers(p.map(q=>q.screeningQuestionID));return Promise.resolve(answers)});const knockout=()=>{let ko=answers().values.map(a=>sender._ko.find(i=>i.screeningQuestionID===a.screeningQuestionID&&(i.questionType==="Text"&&a.answerText?.toLowerCase()===i.knockOutText?.toLowerCase()||i.questionType==="Number"&&a.answerNum===i.knockOutNumber||i.questionType==="Date"&&a.answerDate===i.knockOutDate||i.questionType==="Boolean"&&a.answerBoolean===i.knockOutBoolean||i.questionType==="List"&&a.answerUUID===i.knockOutList||i.questionType==="Multiselect Checkbox"&&(a.answerUUID?.indexOf(i.knockOutList)>=0||a.answerBoolean===i.knockOutBoolean)||i.questionType==="Radio"&&a.answerUUID===i.knockOutList))).filter(a=>a);if(ko?.length>0){w.config().then(c=>{ko.forEach(i=>{let handle=c?.knockout?.find(x=>x.screeningQuestionID===i.screeningQuestionID);if(handle?.alert?.length>0){site?.alertDialog({title:config?.screeningWarningTitle||"Error",message:handle.alert,onClose:()=>{if(handle?.redirect?.length>0){let link=editing?`/site/${dudaAlias}${handle.redirect}?preview=true&insitepreview=true&dm_device=desktop`:handle.redirect;window.location=link}}})?.appendTo(container)||(()=>{alert(handle.alert);if(handle?.redirect?.length>0){let link=editing?`/site/${dudaAlias}${handle.redirect}?preview=true&insitepreview=true&dm_device=desktop`:handle.redirect;window.location=link}})()}})});return false}return true};const validate=()=>{let isOk=true;container.find("input[required], select[required], button[required]").each((i,el)=>{let field=$(el);switch(field.attr("data-qtype")){case"text":case"select":{let val=field.val();isOk=isOk&&val&&val.trim().length>0;break}case"bool":{isOk=isOk&&field.is(":checked");break}case"number":{isOk=isOk&&!isNaN(field.val());break}case"date":{let val=Date.parse(field.val());isOk=isOk&&!isNaN(val);break}case"radio":{isOk=isOk&&container.find(`input[type=radio][name=${field.attr("name")}]`).is(":checked");break}case"file":{isOk=isOk&&sender._answers[field.attr("data-qid")]?.answerFile?.length>0;break}}});return isOk};this._pages=[];this._maxPage=0;this._answers=[];this._screeningTemplateID=undefined;this._fetchQuestions=()=>{site?.loadingDialog()?.appendTo(container);return new Promise(resolve=>{const mock=`[{"page_item_url": "question-c8672398-537f-43f4-8333-dc9cb3647d8d","data":{"screeningQuestionID": "c8672398-537f-43f4-8333-dc9cb3647d8d","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "Header","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": null,"knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "Header","helpText": "help text header","sortOrder": 1,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false}},{"page_item_url": "question-cc741dcf-746a-4c09-b9cd-dd920ca18848","data":{"screeningQuestionID": "cc741dcf-746a-4c09-b9cd-dd920ca18848","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "Boolean Field","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": null,"knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "Boolean","helpText": "help text boolena","sortOrder": 2,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false}},{"page_item_url": "question-3a821d5a-eacb-42f0-8570-a763e2533d66","data":{"screeningQuestionID": "3a821d5a-eacb-42f0-8570-a763e2533d66","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "Date field","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": null,"knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "Date","helpText": "help text date","sortOrder": 3,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false}},{"page_item_url": "question-a1a059c7-c4c7-49b2-9583-42f8d0e5dbf0","data":{"screeningQuestionID": "a1a059c7-c4c7-49b2-9583-42f8d0e5dbf0","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "File attachement","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": null,"knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "File","helpText": "help text file attachement","sortOrder": 4,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false}},{"page_item_url": "question-ff81f8b5-526c-4a43-9a31-2c940d686284","data":{"screeningQuestionID": "ff81f8b5-526c-4a43-9a31-2c940d686284","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "List Field","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": null,"knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "List","helpText": "help text list","sortOrder": 5,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false,"screeningquestionoptions":[{"screeningQuestionOptionsID": "735fbde0-bfe4-4656-8726-773f0584b120","screeningQuestionID": "ff81f8b5-526c-4a43-9a31-2c940d686284","option": "option 2","sortOrder": null,"label": null,"parentOptionID": null},{"screeningQuestionOptionsID": "a5986c6b-df49-45ad-a4e0-e5de5f561f0c","screeningQuestionID": "ff81f8b5-526c-4a43-9a31-2c940d686284","option": "option 1","sortOrder": null,"label": null,"parentOptionID": null}],"options":[{"screeningQuestionOptionsID": "735fbde0-bfe4-4656-8726-773f0584b120","screeningQuestionID": "ff81f8b5-526c-4a43-9a31-2c940d686284","option": "option 2","sortOrder": null,"label": null,"parentOptionID": null},{"screeningQuestionOptionsID": "a5986c6b-df49-45ad-a4e0-e5de5f561f0c","screeningQuestionID": "ff81f8b5-526c-4a43-9a31-2c940d686284","option": "option 1","sortOrder": null,"label": null,"parentOptionID": null}]}},{"page_item_url": "question-82984c70-8733-41e4-a6fe-044b11478b77","data":{"screeningQuestionID": "82984c70-8733-41e4-a6fe-044b11478b77","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "Multi Check Field","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": "cd4f03a7-6fc9-4413-a149-27ff8f1efccf","knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "Multiselect Checkbox","helpText": "help text multi check","sortOrder": 6,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false,"screeningquestionoptions":[{"screeningQuestionOptionsID": "cd4f03a7-6fc9-4413-a149-27ff8f1efccf","screeningQuestionID": "82984c70-8733-41e4-a6fe-044b11478b77","option": "No","sortOrder": null,"label": null,"parentOptionID": null},{"screeningQuestionOptionsID": "fcf3d05d-a6ba-4ef7-b99e-c0d5643bbcc2","screeningQuestionID": "82984c70-8733-41e4-a6fe-044b11478b77","option": "Yes","sortOrder": null,"label": null,"parentOptionID": null}],"options":[{"screeningQuestionOptionsID": "cd4f03a7-6fc9-4413-a149-27ff8f1efccf","screeningQuestionID": "82984c70-8733-41e4-a6fe-044b11478b77","option": "No","sortOrder": null,"label": null,"parentOptionID": null},{"screeningQuestionOptionsID": "fcf3d05d-a6ba-4ef7-b99e-c0d5643bbcc2","screeningQuestionID": "82984c70-8733-41e4-a6fe-044b11478b77","option": "Yes","sortOrder": null,"label": null,"parentOptionID": null}]}},{"page_item_url": "question-d05ce73c-d8b7-4355-84c6-5abef43a6528","data":{"screeningQuestionID": "d05ce73c-d8b7-4355-84c6-5abef43a6528","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "Radio Button","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": null,"knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "Radio","helpText": "help text radio","sortOrder": 7,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false,"screeningquestionoptions":[{"screeningQuestionOptionsID": "7768eb27-7c30-4105-b451-0bfd994b5812","screeningQuestionID": "d05ce73c-d8b7-4355-84c6-5abef43a6528","option": "Yes","sortOrder": null,"label": null,"parentOptionID": null},{"screeningQuestionOptionsID": "8aadcca1-3af2-4ee2-a71a-65e2d11e8579","screeningQuestionID": "d05ce73c-d8b7-4355-84c6-5abef43a6528","option": "No","sortOrder": null,"label": null,"parentOptionID": null}],"options":[{"screeningQuestionOptionsID": "7768eb27-7c30-4105-b451-0bfd994b5812","screeningQuestionID": "d05ce73c-d8b7-4355-84c6-5abef43a6528","option": "Yes","sortOrder": null,"label": null,"parentOptionID": null},{"screeningQuestionOptionsID": "8aadcca1-3af2-4ee2-a71a-65e2d11e8579","screeningQuestionID": "d05ce73c-d8b7-4355-84c6-5abef43a6528","option": "No","sortOrder": null,"label": null,"parentOptionID": null}]}},{"page_item_url": "question-143386b4-2650-4b2c-b4d6-f934df354da7","data":{"screeningQuestionID": "143386b4-2650-4b2c-b4d6-f934df354da7","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "Free Text Field","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": null,"knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "Text","helpText": "help text free text","sortOrder": 8,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false}},{"page_item_url": "question-977af240-8639-47ac-a244-9f1a5eacd96a","data":{"screeningQuestionID": "977af240-8639-47ac-a244-9f1a5eacd96a","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "MultiSelect List","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": null,"knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "Multiselect List","helpText": "help text multi list","sortOrder": 9,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false,"screeningquestionoptions":[{"screeningQuestionOptionsID": "5d1f79a3-0cfd-47be-9c2b-b14b023b48ac","screeningQuestionID": "977af240-8639-47ac-a244-9f1a5eacd96a","option": "option 1","sortOrder": null,"label": null,"parentOptionID": null},{"screeningQuestionOptionsID": "34e6e720-6a84-4936-82f8-b9c1c6dba2f6","screeningQuestionID": "977af240-8639-47ac-a244-9f1a5eacd96a","option": "option 2","sortOrder": null,"label": null,"parentOptionID": null}],"options":[{"screeningQuestionOptionsID": "5d1f79a3-0cfd-47be-9c2b-b14b023b48ac","screeningQuestionID": "977af240-8639-47ac-a244-9f1a5eacd96a","option": "option 1","sortOrder": null,"label": null,"parentOptionID": null},{"screeningQuestionOptionsID": "34e6e720-6a84-4936-82f8-b9c1c6dba2f6","screeningQuestionID": "977af240-8639-47ac-a244-9f1a5eacd96a","option": "option 2","sortOrder": null,"label": null,"parentOptionID": null}]}},{"page_item_url": "question-e00713b8-00aa-4b4f-b864-e328de7e4fe7","data":{"screeningQuestionID": "e00713b8-00aa-4b4f-b864-e328de7e4fe7","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "Number1","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": null,"knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "Number","helpText": "help text number","sortOrder": 10,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false}},{"page_item_url": "question-b1627441-583a-4b0d-927a-c27565289887","data":{"screeningQuestionID": "b1627441-583a-4b0d-927a-c27565289887","screeningTemplateID": "1d85c583-a792-4aff-b323-f7dec578ee1a","question": "Rater??","isSubQuestion": false,"parentQuestionID": null,"knockOutDate": null,"knockOutList": null,"knockOutText": null,"knockOutNumber": null,"knockOutBoolean": null,"questionType": "Rater","helpText": "help text rater","sortOrder": 11,"isMandatory": false,"length": null,"isHelpTextCollapse": false,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","defaultAnswer": null,"hide": false}}]`;let fetchTemplate=()=>editing&&!tid&&!jid&&Promise.resolve(JSON.parse(mock))||tid&&shazamme.fetch(collection.questions).then(c=>Promise.resolve(c?.filter(i=>i.data.screeningTemplateID===tid)))||shazamme.fetch(collection.jobs).then(j=>Promise.resolve(j?.find(i=>i.data.jobID===jid)?.data?.screeningTemplateID)).then(tid=>Promise.all([tid,shazamme.fetch(collection.questions)])).then(r=>Promise.resolve(r[1]?.filter(i=>i.data.screeningTemplateID===r[0])));fetchTemplate().then(t=>{sender._screeningTemplateID=t.at(0)?.data.screeningTemplateID;sender._pages=[];t.forEach(q=>{let pIndex=Math.floor((parseInt(q.data.sortOrder)||0)/100);sender._pages[pIndex]=sender._pages[pIndex]||[];sender._pages[pIndex].push(q.data)});for(let i=0;i<sender._pages.length;i++){if(!sender._pages[i]){sender._pages.splice(i,1)}}sender._ko=t.filter(q=>q.data.knockOutDate||q.data.knockOutList||q.data.knockOutText||q.data.knockOutNumber||q.data.knockOutBoolean!==null).map(q=>q.data);resolve()})})};this._showQuestions=(page,scrollIntoView=true)=>{if(page>this.pageNumber&&!validate()){let warning=config?.warningScreeningQuestions||"Please answer all questions";site?.alertDialog({title:config?.warningScreeningQuestionsTitle||"Error",message:warning})?.appendTo(container)||alert(warning);return}this._recordAnswers();if(page>this._maxPage){this._maxPage=page}let p=(this._pages[page]||[]).filter(q=>!q.parentQuestionID||sender._answers[q.parentQuestionID]);let el=p.map(q=>sender._questionEl({...q,options:q.options?.filter(o=>!q.parentQuestionID||sender._answers[q.parentQuestionID].answerUUID?.indexOf(o.parentOptionID)>=0)}));container.empty().append(el).append(sender._pagingElements(page));container.find(".sq-help-text[collapsible]").each(function(_,i){let helpText=$(i);let height=$(helpText).outerHeight();helpText.find(".text-main").attr("style",`--shaz-help-text-lines: ${config.helpTextLines||3}`);if(helpText.outerHeight()<height){helpText.addClass("collapsible").on("click","[data-rel=button-show-more]",function(){let button=$(this);if(helpText.hasClass("expanded")){helpText.find(".text-main").css({display:"-webkit-box"});helpText.removeClass("expanded")}else{helpText.find(".text-main").css({display:"block"});helpText.addClass("expanded")}})}});container.find("[data-rel=screening-page-index]").click(function(){let page=parseInt($(this).attr("data-page"))||0;sender._showQuestions(page)});container.find("[data-qtype=file]").on("click",function(){let f=$(this);let field=f.attr("data-qid");const message=shazamme.bag("site-config")?.message;shazamme.pub(message?.uploadShow,{showFiles:true});let uploadH=shazamme.sub(message?.uploadSubmit,upload=>{shazamme.unsub(uploadH);shazamme.unsub(cancelH);if(upload?.length>0){sender._answers[field]={screeningQuestionID:field,answerFile:upload[0].content,answerFileName:upload[0].name,screeningTemplateID:sender._screeningTemplateID};f.hide().parents(".input-field-container").find("[data-rel=file-list]").empty().append(_fileEl(upload[0]).on("click","[data-rel=action-remove]",function(){delete sender._answers[field];f.show();$(this).parents("article").remove()}))}});let cancelH=shazamme.sub(message?.uploadCancel,()=>{shazamme.unsub(uploadH);shazamme.unsub(cancelH)})});if(this._pages[page]?.find(q=>q.parentQuestionID)){container.find("input, select").on("change",function(){sender._recordAnswers();sender._showQuestions(page,false)})}container.find("[data-rel=screening-apply]").click(function(){if(!validate()){let warning=config?.warningScreeningQuestions||"Please answer all questions";site?.alertDialog({title:config?.warningScreeningQuestionsTitle||"Error",message:warning})?.appendTo(container)||alert(warning);return}shazamme.pub(Message.submit,{plugin:sender,w:w})});if(scrollIntoView){container.get(0).scrollIntoView();window.scrollBy({top:-200,behavior:"smooth"})}this._restoreAnswers(p.map(q=>q.screeningQuestionID));this.pageNumber=page};this._questionEl=q=>{if(q.parentQuestionID?.length>0&&!(q.options?.length>0)){return""}switch(q.questionType){case"Text":return`
                             <div class="input-field-container">
                                <label class="text ${q.isMandatory?"required":""}">${q.question}</label>
                                <input class="sq-input-text-style" type="text" maxlength=${q.length||-1} autocomplete="nope" data-qtype="text" data-qid="${q.screeningQuestionID}" ${q.isMandatory?"required":""} />
                                ${q.helpText?.length>0&&`
                                <div class="sq-help-text" ${q.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${q.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${config.readMoreAlign}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${config.showMoreHelpText}</a>
                                    </div>
                                </div>
                                `||""}
                            </div>
                        `;case"Number":return`
                             <div class="input-field-container">
                                <label class="text ${q.isMandatory?"required":""}">${q.question}</label>
                                <input type="number" autocomplete="nope" data-qtype="number" data-qid="${q.screeningQuestionID}" ${q.isMandatory?"required":""} />
                                ${q.helpText?.length>0&&`
                                <div class="sq-help-text" ${q.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${q.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${config.readMoreAlign}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${config.showMoreHelpText}</a>
                                    </div>
                                </div>
                                `||""}
                            </div>
                        `;case"Date":return`
                             <div class="input-field-container">
                                <label class="text ${q.isMandatory?"required":""}">${q.question}</label>
                                <input type="date" autocomplete="nope" data-qtype="date" data-qid="${q.screeningQuestionID}" ${q.isMandatory?"required":""} />
                                ${q.helpText?.length>0&&`
                                <div class="sq-help-text" ${q.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${q.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${config.readMoreAlign}; --shaz-showMoreShadowColor: ${config.showMoreShadowColor}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${config.showMoreHelpText}</a>
                                    </div>
                                </div>
                                `||""}
                            </div>
                        `;case"Boolean":return`
                             <div class="input-field-container">
                                <label class="text ${q.isMandatory?"required":""}">${q.question}</label>
                                    <p class="sq-boolean-question">
                                        <input type="checkbox" autocomplete="nope" data-qtype="bool" data-qid="${q.screeningQuestionID}" ${q.isMandatory?"required":""}  />
                                        ${q.question}
                                    </p>
                                </label>
                                ${q.helpText?.length>0&&`
                                <div class="sq-help-text" ${q.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${q.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${config.readMoreAlign}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${config.showMoreHelpText}</a>
                                    </div>
                                </div>
                                `||""}
                            </div>
                        `;case"List":{let opts=q.options.map(o=>`<option value="${o.screeningQuestionOptionsID}">${o.label||o.option}</option>`);return`
                             <div class="input-field-container">
                                <label class="text ${q.isMandatory?"required":""}">${q.question}</label>
                                <select data-qtype="list" data-qid="${q.screeningQuestionID}" ${q.isMandatory?"required":""}>${opts.join("")}</select>
                                ${q.helpText?.length>0&&`
                                <div class="sq-help-text" ${q.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${q.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${config.readMoreAlign}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${config.showMoreHelpText}</a>
                                    </div>
                                </div>
                                `||""}
                             </div>
                        `}case"Multiselect List":case"Multiselect Checkbox":{let opts=q.options.map(o=>`<label><input type="checkbox" autocomplete="nope" data-qtype="check-list" data-qid="${q.screeningQuestionID}" data-value="${o.screeningQuestionOptionsID}" />${o.label||o.option}</label>`);return`
                             <div class="input-field-container">
                                <label class="text ${q.isMandatory?"required":""}">${q.question}</label>
                                ${q.helpText?.length>0&&`
                                <div class="sq-help-text" ${q.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${q.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${config.readMoreAlign}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${config.showMoreHelpText}</a>
                                    </div>
                                </div>
                                `||""}
                                <div class="input-options-container">${opts.join("")}</div>
                             </div>
                        `}case"Radio":{let opts=q.options.map(o=>`<label class="sq-question-option"><input type="radio" data-qtype="radio" name="${q.screeningQuestionID}" data-qid="${q.screeningQuestionID}" value="${o.screeningQuestionOptionsID}" ${q.isMandatory?"required":""} />${o.label||o.option}</label>`);return`
                             <div class="input-field-container">
                                <label class="text ${q.isMandatory?"required":""}">${q.question}</label>
                                ${q.helpText?.length>0&&`
                                <div class="sq-help-text" ${q.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${q.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${config.readMoreAlign}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${config.showMoreHelpText}</a>
                                    </div>
                                </div>
                                `||""}
                                <div class="sq-opt-list">${opts.join("")}</div>
                             </div>
                        `}case"File":return`
                             <div class="input-field-container">
                                <label class="text ${q.isMandatory?"required":""}">${q.question}</label>

                                <button class="file" data-qtype="file" data-qid="${q.screeningQuestionID}" ${q.isMandatory?"required":""}>
                                    <span class="text">${config?.uploadButtonText||"Select..."}</span>
                                </button>

                                <div class="sq-file-list" data-rel="file-list"></div>

                                ${q.helpText?.length>0&&`
                                <div class="sq-help-text" ${q.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${q.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${config.readMoreAlign}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${config.showMoreHelpText}</a>
                                    </div>
                                </div>
                                `||""}
                            </div>
                        `;case"Header":return`
                            <div class='screening-question-heading'>
                                <h3>${q.question}</h3>
                                ${q.helpText?.length>0&&`
                                <div class="sq-help-text" ${q.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${q.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${config.readMoreAlign}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${config.showMoreHelpText}</a>
                                    </div>
                                </div>
                                `||""}
                        </div>
                        `;default:return""}};this._fileEl=f=>$(`
                    <article class="item-file">
                        <span class="text">${f.name||"(unknown)"}</span>
                        <button class="action-remove" data-rel="action-remove"><span class="text">X</span></button>
                    </article>
                `);this._pagingElements=page=>{let out=[];out.push(`<div data-rel="screening-pages" class="screening-pages-container" style="--shaz-text-align: ${config.pagingButtonAlignment}">`);if(page>0){out.push(`<a href='javascript:void(0);' class="button-page-nav back" data-rel='screening-page-index' data-page='${page-1}'><span class="text">${config.prevPageButton||"Back"}</span></a>`)}if(page<this._pages.length-1){out.push(`<a href='javascript:void(0);' class="button-page-nav forward" data-rel='screening-page-index' data-page='${page+1}'><span class="text">${config.nextPageButton||"Next"}</span></a>`)}else if(config.showApply){out.push(`<a href='javascript:void(0);' class="button-page-nav forward" data-rel='screening-apply'><span class="text">${config.applyButton||"Apply"}</span></a>`)}if(this._pages.length>1){let buttons=new Array(this._maxPage+1);for(let i=0;i<buttons.length;i++){buttons[i]=`<a href='javascript:void(0);' class="button-page-index ${i===page?"active":""}" data-rel='screening-page-index' data-page='${i}'></a>`}for(let i=buttons.length;i<this._pages.length;i++){buttons[i]=`<a href='javascript:void(0);' class="button-page-index disabled"></a>`}out.push(`<div class="sq-pages-index">${buttons.join("")}</div>`)}out.push("</div>");return out.join("")};this._recordAnswers=()=>{container.find("input, select").each((i,el)=>{let field=$(el);switch(field.attr("data-qtype")){case"text":{if(field.val()){sender._answers[field.attr("data-qid")]={screeningAnswerID:sender._answers[field.attr("data-qid")]?.screeningAnswerID,screeningQuestionID:field.attr("data-qid"),answerText:field.val(),screeningTemplateID:sender._screeningTemplateID}}else{delete sender._answers[field.attr("data-qid")]}break}case"number":{if(field.val()){sender._answers[field.attr("data-qid")]={screeningAnswerID:sender._answers[field.attr("data-qid")]?.screeningAnswerID,screeningQuestionID:field.attr("data-qid"),answerNum:parseInt(field.val()),screeningTemplateID:sender._screeningTemplateID}}else{delete sender._answers[field.attr("data-qid")]}break}case"date":{if(field.val()){sender._answers[field.attr("data-qid")]={screeningAnswerID:sender._answers[field.attr("data-qid")]?.screeningAnswerID,screeningQuestionID:field.attr("data-qid"),answerDate:field.val(),screeningTemplateID:sender._screeningTemplateID}}else{delete sender._answers[field.attr("data-qid")]}break}case"bool":{sender._answers[field.attr("data-qid")]={screeningAnswerID:sender._answers[field.attr("data-qid")]?.screeningAnswerID,screeningQuestionID:field.attr("data-qid"),answerBoolean:field.is(":checked")?1:0,screeningTemplateID:sender._screeningTemplateID};break}case"list":{if(field.val()){sender._answers[field.attr("data-qid")]={screeningAnswerID:sender._answers[field.attr("data-qid")]?.screeningAnswerID,screeningQuestionID:field.attr("data-qid"),answerUUID:field.val(),screeningTemplateID:sender._screeningTemplateID}}else{delete sender._answers[field.attr("data-qid")]}break}case"check-list":{let id=field.attr("data-qid");let a=sender._answers[id]?.answerUUID||[];if(field.is(":checked")){a.indexOf(field.attr("data-value"))<0&&a.push(field.attr("data-value"))}else if(a.indexOf(field.attr("data-value"))>=0){a.splice(a.indexOf(field.attr("data-value")),1)}if(a.length===0){delete sender._answers[field.attr("data-qid")]}else{sender._answers[id]={screeningAnswerID:sender._answers[id]?.screeningAnswerID,screeningQuestionID:field.attr("data-qid"),answerUUID:a,screeningTemplateID:sender._screeningTemplateID}}break}case"radio":{if(field.is(":checked")){sender._answers[field.attr("data-qid")]={screeningAnswerID:sender._answers[field.attr("data-qid")]?.screeningAnswerID,screeningQuestionID:field.attr("data-qid"),answerUUID:field.attr("value"),screeningTemplateID:sender._screeningTemplateID}}break}}})};this._restoreAnswers=q=>{for(let qid in sender._answers){let ans=sender._answers[qid];qid=qid.split(":")[0];if(q.indexOf(qid)<0){continue}if(container.find(`input[data-qid=${qid}]:visible, select[data-qid=${qid}]:visible`).length===0){delete sender._answers[qid];continue}if(ans.answerText||ans.answerNum){container.find(`input[data-qid=${qid}]`).val(ans.answerText||ans.answerNum)}else if(ans.answerDate){container.find(`input[data-qid=${qid}]`).val(ans.answerDate.substr(0,10))}else if(ans.answerBoolean&&!ans.answerUUID){container.find(`input[data-qid=${qid}]`).attr("checked",true)}else if(ans.answerUUID){if(typeof ans.answerUUID==="string"){ans.answerUUID=ans.answerUUID.split(",")}ans.answerUUID.forEach(v=>{container.find(`input[data-qid=${qid}][data-value=${v.trim()}]`).attr("checked",true);container.find(`input[data-qid=${qid}][value=${v.trim()}]`).attr("checked",true);container.find(`select[data-qid=${qid}]`).val(v.trim())})}else if(ans.answerFile){container.find(`input[data-qid=${qid}]`).val(this._fileBlob(ans.answerFile))}}};this._readFile=file=>{return new Promise(res=>{let reader=new FileReader;reader.addEventListener("load",()=>{res(btoa(reader.result))},false);reader.readAsBinaryString(file)})};this._fileBlob=(b64Data,contentType="",sliceSize=512)=>{const byteCharacters=atob(b64Data);const byteArrays=[];for(let offset=0;offset<byteCharacters.length;offset+=sliceSize){const slice=byteCharacters.slice(offset,offset+sliceSize);const byteNumbers=new Array(slice.length);for(let i=0;i<slice.length;i++){byteNumbers[i]=slice.charCodeAt(i)}const byteArray=new Uint8Array(byteNumbers);byteArrays.push(byteArray)}const blob=new Blob(byteArrays,{type:contentType});return blob};this._showEditor=()=>{const dialog=$(`
                    <div class="dialog dialog-knockout editor-only" data-rel="dialog" data-dialog="knockout">
                        <div class="content" data-rel="dialog-content"></div>

                        <div class="buttons">
                            <button class="submit" data-rel="button-submit"><span class="text">OK</span></button>
                            <button class="dismiss" data-rel="button-dismiss"><span class="text">Cancel</span></button>
                        </div>
                    </div>
                `).appendTo(container);const option=q=>{if(q.knockOutDate){return new Date(q.knockOutDate).toLocaleDateString()}if(q.knockOutList){return q.options?.find(i=>i.screeningQuestionOptionsID===q.knockOutList)?.option}if(q.knockOutText){return q.knockOutText}if(q.knockOutNumber){return q.knockOutNumber}if(q.knockOutBoolean!==null){return q.knockOutBoolean?"Yes":"No"}return""};const el=q=>`
                    <article data-rel="knockout" data-id="${q.screeningQuestionID}">
                        <div class="row">
                            <label>${q.question}</label>
                            <label>${option(q)}</label>
                        </div>

                        <div class="row">
                            <label>
                                Message
                                <input type="text" data-rel="alert" placeholder="Sorry, we can accept you at this time." value="${q.alert||""}" />
                            </label>

                            <label>
                                Redirect (Leave blank for no redirect)
                                <input type="text" data-rel="redirect" placeholder="/reject" value="${q.redirect||""}" />
                            </label>
                        </div>

                        <div class="row">
                            <label>
                                Enable
                                <input type="checkbox" data-rel="enable" ${q.alert?.length>0||q.redirect?.length>0?'checked="checked"':""} />
                            </label>
                        </div>
                    </article>
                `;if(sender._ko.length===0){return}w.config().then(c=>{dialog.find("[data-rel=dialog-content]").empty().append(sender._ko.map(q=>el({...q,...c?.knockout?.find(i=>i.screeningQuestionID===q.screeningQuestionID)})));container.find(".button-editor").remove();$("<button />").text("Edit Knockout Handling").addClass("button-editor").on("click",function(){dialog.toggle()}).prependTo(container);const toggleEnable=e=>{let toggle=$(e.target);$("<input />").attr({type:"checkbox","data-rel":"enable",checked:toggle.is(":checked")?"checked":null}).on("click",toggleEnable).appendTo(toggle.parent());toggle.remove()};dialog.find("[data-rel=enable]").on("click",toggleEnable);dialog.find("[data-rel=button-submit]").on("click",function(){let knockout=c?.knockout||[];dialog.find("[data-rel=dialog-content] article [data-rel=enable]").each((_,i)=>{let el=$(i).parents("article");let s=knockout.find(i=>i.screeningQuestionID===el.attr("data-id"));if(s){knockout.splice(knockout.indexOf(s),1)}if($(i).is(":checked")){knockout.push({screeningQuestionID:el.attr("data-id"),alert:el.find("[data-rel=alert]").val(),redirect:el.find("[data-rel=redirect]").val()})}});w.config().then(c=>w.config({...c,knockout:knockout})).then(()=>{c.knockout=knockout});dialog.toggle()});dialog.find("[data-rel=button-dismiss]").on("click",function(){dialog.toggle();dialog.find("[data-rel=dialog-content]").empty().append(sender._ko.map(q=>el({...q,...c?.knockout?.find(i=>i.screeningQuestionID===q.screeningQuestionID)})));dialog.find("[data-rel=enable]").on("click",toggleEnable)})})};w.log(`Loading plugin: screening-questions (${Version})`);shazamme.bag("plugin-screening-question",{message:Message,version:Version});return this._fetchQuestions().then(()=>{this._showQuestions(0,false);if(editing){this._showEditor()}return Promise.resolve({nextPage:nextPage,prevPage:prevPage,answers:answers,loadAnswers:loadAnswers,knockout:knockout,container:container,validate:validate,message:Message,version:Version})})}}})();