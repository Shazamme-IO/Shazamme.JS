(()=>{const e="1.0.0",t={submit:"screening-question-job-adder-apply"};shazamme.style(`https://sdk.shazamme.io/js/plugin/screening-question-job-adder/${e}/plugin.css`).then(),shazamme.plugin={...shazamme.plugin,screeningQuestions:(a,s)=>{const n=s?.collection||{},i=s?.config||{},r=s?.container||$('<div data-rel="screening-fields"></div>'),l=!0===s?.editing,o=s?.jid,d=this;this.pageNumber=0,this.isValid=!0;const c=()=>{this._showQuestions(this.pageNumber+1)},p=()=>{this._showQuestions(this.pageNumber-1)},u=()=>{let e=[];this._recordAnswers();for(let t in this._answers)e.push(this._answers[t]);return e},h=e=>shazamme.site().then((t=>shazamme.submit({action:"Get Screening Answers - JA",siteID:t.siteID,jobApplicationID:e}))).then((e=>{let t=[];return e?.response?.items?.forEach((e=>{t[e.screeningQuestionID]=e})),this._answers=t,this._restoreAnswers(),Promise.resolve(t)})),g=e=>!0,b=()=>{let e=!0;return r.find("input[required], select[required]").each(((t,a)=>{let s=$(a);switch(s.attr("data-qtype")){case"text":case"select":{let t=s.val();e=e&&t&&t.trim().length>0;break}case"bool":e=e&&s.is(":checked");break;case"number":e=e&&!isNaN(s.val());break;case"date":{let t=Date.parse(s.val());e=e&&!isNaN(t);break}case"check-list":case"radio":e=e&&r.find(`input[type=radio][name=${s.attr("name")}]`).is(":checked");break;case"file":e=e&&s.get(0).files.length>0}})),e};return this._pages=[],this._maxPage=0,this._answers=[],this._screeningTemplateID=void 0,this._fetchQuestions=()=>new Promise((e=>{l&&!o&&Promise.resolve(JSON.parse('{"pages": 1,"items":[{"jAScreeningQuestionID": "b81b532d-38d4-4eae-8c8b-425c9820ea7a","jobID": "3ba79e50-215e-456e-8fad-e7c8d68088d7","question": "How old are you?","isMandatory": true,"isMultiSelect": false,"answerType": "Text","index": 2,"jascreeningquestionanswer": null},{"jAScreeningQuestionID": "5b609ea6-54a5-4926-9706-970b92a23bef","jobID": "3ba79e50-215e-456e-8fad-e7c8d68088d7","question": "What is your gender","isMandatory": true,"isMultiSelect": false,"answerType": "List","index": 3,"jascreeningquestionanswer":[{"jAScreeningQuestionAnswerID": "98dc8df8-0473-4833-9d92-91a7b928e7f6","sort": 0,"value": "Male","jobID": "3ba79e50-215e-456e-8fad-e7c8d68088d7","index": 3},{"jAScreeningQuestionAnswerID": "b143ad1a-31d0-464f-92c4-39a07c9c4bac","sort": 1,"value": "Female","jobID": "3ba79e50-215e-456e-8fad-e7c8d68088d7","index": 3}]},{"jAScreeningQuestionID": "761e252e-cfa2-4ca6-82b5-95f33e36379c","jobID": "3ba79e50-215e-456e-8fad-e7c8d68088d7","question": "Where do you live?","isMandatory": true,"isMultiSelect": false,"answerType": "Text","index": 4,"jascreeningquestionanswer": null},{"jAScreeningQuestionID": "70b15595-ebf0-49c5-a867-5758239c977e","jobID": "3ba79e50-215e-456e-8fad-e7c8d68088d7","question": "Select any of the following","isMandatory": true,"isMultiSelect": true,"answerType": "List","index": 5,"jascreeningquestionanswer":[{"jAScreeningQuestionAnswerID": "398ded85-a711-40dd-bd32-21378c76cf18","sort": 0,"value": "One","jobID": "3ba79e50-215e-456e-8fad-e7c8d68088d7","index": 5},{"jAScreeningQuestionAnswerID": "6359e9ad-ec68-476d-90a0-5717541c3ad3","sort": 1,"value": "Two","jobID": "3ba79e50-215e-456e-8fad-e7c8d68088d7","index": 5},{"jAScreeningQuestionAnswerID": "6113d191-e77f-4ff6-a40d-40be5eb1a48b","sort": 2,"value": "Three","jobID": "3ba79e50-215e-456e-8fad-e7c8d68088d7","index": 5}]}]}'))||shazamme.fetch(n.questions).then((e=>Promise.resolve(e?.filter((e=>e.data.jobID===o))))).then((t=>{t?.length>0&&(d._pages[0]||(d._pages[0]=[]),d._pages[0]=d._pages[0].concat(t.map((e=>e.data)))),e()}))})),this._showQuestions=(e,a=!0)=>{if(e>this.pageNumber&&!b())return void alert("Please answer all questions");this._recordAnswers(),e>this._maxPage&&(this._maxPage=e);let s=(this._pages[e]||[]).filter((e=>!e.parentQuestionID||d._answers[e.parentQuestionID])).map((e=>d._questionEl({...e,options:e.jascreeningquestionanswer?.filter((t=>!e.parentQuestionID||d._answers[e.parentQuestionID].answerUUID?.indexOf(t.parentOptionID)>=0))||[]})));r.empty().append(s).append(d._pagingElements(e)),r.find(".sq-help-text[collapsible]").each((function(e,t){let a=$(t),s=$(a).outerHeight();a.find(".text-main").attr("style",`--shaz-help-text-lines: ${i.helpTextLines||3}`),a.outerHeight()<s&&a.addClass("collapsible").on("click","[data-rel=button-show-more]",(function(){$(this);a.hasClass("expanded")?(a.find(".text-main").css({display:"-webkit-box"}),a.removeClass("expanded")):(a.find(".text-main").css({display:"block"}),a.addClass("expanded"))}))})),r.find("[data-rel=screening-page-index]").click((function(){let e=parseInt($(this).attr("data-page"))||0;d._showQuestions(e)})),this._pages[e]?.find((e=>e.parentQuestionID))&&r.find("input, select").on("change",(function(){d._recordAnswers(),d._showQuestions(e,!1)})),r.find("[data-rel=screening-apply]").click((function(){b()?shazamme.pub(t.submit):alert("Please answer all questions")})),a&&(r.get(0).scrollIntoView(),window.scrollBy({top:-200,behavior:"smooth"})),this._restoreAnswers(),this.pageNumber=e},this._questionEl=e=>{switch(e.answerType){case"Text":return`\n                             <div class="input-field-container">\n                                <label class="text ${e.isMandatory?"required":""}">\n                                    ${e.question}\n                                </label>\n                                ${e.helpText?.length>0?`<div class="sq-help-text" ${e.isHelpTextCollapse?"collapsible":""}>\n                                        <p class="text-main">${e.helpText||""}</p>\n                                        <div class="section-read-more" style="text-align: ${i.readMoreAlign}">\n                                            <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${i.showMoreHelpText}</a>\n                                        </div>\n                                    </div>`:""}\n                                <input class="sq-input-text-style" type="text" maxlength=${e.length||-1} autocomplete="nope" data-qtype="text" data-qid="${e.jAScreeningQuestionID}" ${e.isMandatory?"required":""} />\n                            </div>\n                        `;case"List":{let t=e.options.map((t=>`<label class="sq-question-option"><input type="${e.isMultiSelect?"checkbox":"radio"}" name="${e.jAScreeningQuestionID}" data-qtype="${e.isMultiSelect?"check-list":"radio"}" data-qid="${e.jAScreeningQuestionID}" data-value="${t.jAScreeningQuestionAnswerID}" ${e.isMandatory?"required":""} />${t.value}</label>`));return`\n                             <div class="input-field-container">\n                                <label class="text ${e.isMandatory?"required":""}">\n                                    ${e.question}\n                                </label>\n                                ${e.helpText?.length>0?`<div class="sq-help-text" ${e.isHelpTextCollapse?"collapsible":""}>\n                                        <p class="text-main">${e.helpText||""}</p>\n                                        <div class="section-read-more" style="text-align: ${i.readMoreAlign}">\n                                            <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${i.showMoreHelpText}</a>\n                                        </div>\n                                    </div>`:""}\n                                ${t.join("")}\n                             </div>\n                        `}default:return""}},this._pagingElements=e=>{let t=[];if(t.push("<div data-rel='screening-pages' class='screening-pages-container'>"),e>0&&t.push(`<a href='javascript:void(0);' class="button-page-nav back" data-rel='screening-page-index' data-page='${e-1}'>Back</a>`),this._pages.length>0&&e<this._pages.length-1?t.push(`<a href='javascript:void(0);' class="button-page-nav forward" data-rel='screening-page-index' data-page='${e+1}'>Next</a>`):i.showApply&&t.push("<a href='javascript:void(0);' class=\"button-page-nav forward apply\" data-rel='screening-apply'>Apply</a>"),this._pages.length>1){let a=new Array(this._maxPage+1);for(let t=0;t<a.length;t++)a[t]=`<a href='javascript:void(0);' class="button-page-index ${t===e?"active":""}" data-rel='screening-page-index' data-page='${t}'></a>`;for(let e=a.length;e<this._pages.length;e++)a[e]="<a href='javascript:void(0);' class=\"button-page-index disabled\"></a>";t.push(`<div class="sq-pages-index">${a.join("")}</div>`)}return t.push("</div>"),t.join("")},this._presentList=e=>{e.map((e=>`\n                    <div>\n                        <input type="checkbox" data-value="${e.value}" />\n                        ${e.label||e.option}\n                    </div>\n                `));let t=`\n                    <div data-rel="dialog-answer-list">\n                        <div class="list-options">${ops.join("")}</div>\n                        <input type="button">OK</button>\n                    </div>\n                `;$(t).appendTo($(element))},this._recordAnswers=()=>{r.find("input, select").each(((e,t)=>{let a=$(t);switch(a.attr("data-qtype")){case"text":d._answers[a.attr("data-qid")]={jobAppJaSqID:shazamme.uuid(),jAScreeningQuestionID:a.attr("data-qid"),answer:a.val()};break;case"radio":case"check-list":{let e=a.attr("data-qid"),t=d._answers[e]?.listAnswers||[];if(a.is(":checked"))t.indexOf(a.attr("data-value"))<0&&t.push({jAScreeningQuestionAnswerID:a.attr("data-value")});else{let e=t.find((e=>e.jAScreeningQuestionAnswerID===a.attr("data-value")));e&&t.splice(t.indexOf(e),1)}0===t.length?delete d._answers[a.attr("data-qid")]:d._answers[e]={jobAppJaSqID:shazamme.uuid(),jAScreeningQuestionID:a.attr("data-qid"),listAnswers:t};break}}}))},this._restoreAnswers=()=>{for(let e in d._answers){let t=d._answers[e];e=e.split(":")[0];let a=r.find(`input[data-qid=${e}]`);switch(a.attr("data-qtype")){case"text":case"number":case"date":a.val(t.answer);break;case"bool":a.attr("checked",!0);break;case"list":case"check-list":case"radio":t.listAnswers?.forEach((t=>{r.find(`input[data-qid=${e}][value=${t.jAScreeningQuestionAnswerID}]`).attr("checked",!0),r.find(`select[data-qid=${e}]`).val(t.jAScreeningQuestionAnswerID)}))}}},this._readFile=e=>new Promise((t=>{let a=new FileReader;a.addEventListener("load",(()=>{t(btoa(a.result))}),!1),a.readAsBinaryString(e)})),this._fileBlob=(e,t="",a=512)=>{const s=atob(e),n=[];for(let e=0;e<s.length;e+=a){const t=s.slice(e,e+a),i=new Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);const r=new Uint8Array(i);n.push(r)}return new Blob(n,{type:t})},a.log(`Loading plugin: screening-question-job-adder (${e})`),shazamme.bag("plugin-screening-question-job-adder",{message:t,version:e}),this._fetchQuestions().then((()=>(this._showQuestions(0,!1),Promise.resolve({nextPage:c,prevPage:p,answers:u,loadAnswers:h,knockout:g,container:r,validate:b,message:t,version:e}))))}}})();