'use strict';(()=>{const n={submit:"screening-question-job-adder-apply"};shazamme.style("https://sdk.shazamme.io/js/plugin/screening-question-job-adder/1.0.0/plugin.css").then();shazamme.plugin={...shazamme.plugin,screeningQuestions:(u,l)=>{const v=l?.collection||{},k=l?.config||{},g=l?.container||$('<div data-rel="screening-fields"></div>'),r=!0===l?.editing,p=l?.jid,e=this;this.pageNumber=0;this.isValid=!0;const w=()=>{this._showQuestions(this.pageNumber+1)},x=()=>{this._showQuestions(this.pageNumber-
1)},y=()=>{let a=[];this._recordAnswers();for(let b in this._answers)a.push(this._answers[b]);return a},z=a=>shazamme.site().then(b=>shazamme.submit({action:"Get Screening Answers - JA",siteID:b.siteID,jobApplicationID:a})).then(b=>{let c=[];b?.response?.items?.forEach(d=>{c[d.screeningQuestionID]=d});this._answers=c;this._restoreAnswers();return Promise.resolve(c)}),A=a=>!0,q=()=>{let a=!0;g.find("input[required], select[required]").each((b,c)=>{b=$(c);switch(b.attr("data-qtype")){case "text":case "select":b=
b.val();a=a&&b&&0<b.trim().length;break;case "bool":a=a&&b.is(":checked");break;case "number":a=a&&!isNaN(b.val());break;case "date":b=Date.parse(b.val());a=a&&!isNaN(b);break;case "check-list":case "radio":a=a&&g.find(`input[type=radio][name=${b.attr("name")}]`).is(":checked");break;case "file":a=a&&0<b.get(0).files.length}});return a};this._pages=[];this._maxPage=0;this._answers=[];this._screeningTemplateID=void 0;this._fetchQuestions=()=>new Promise(a=>{(r&&!p&&Promise.resolve(JSON.parse('[{"page_item_url": "question-67176e27-ab69-4ec3-8b18-f7f68162a5a4","data": {"jAScreeningQuestionID": "67176e27-ab69-4ec3-8b18-f7f68162a5a4","jobID": "ec5731fe-7e97-44df-8c14-e2b9585338cb","question": "How old are you?","isMandatory": true,"isMultiSelect": false,"answerType": "Text","index": 2,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc"}},{"page_item_url": "question-bfc545b9-31f7-49e3-9834-7e6d750212a9","data": {"jAScreeningQuestionID": "bfc545b9-31f7-49e3-9834-7e6d750212a9","jobID": "ec5731fe-7e97-44df-8c14-e2b9585338cb","question": "What is your gender","isMandatory": true,"isMultiSelect": false,"answerType": "List","index": 3,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","jascreeningquestionanswer": [{"jAScreeningQuestionAnswerID": "9085af4d-966a-480d-a259-14f749a06d38","sort": 0,"value": "Male","jobID": "ec5731fe-7e97-44df-8c14-e2b9585338cb","index": 3},{"jAScreeningQuestionAnswerID": "71473964-16ad-44fe-9bf6-99e37f34de26","sort": 1,"value": "Female","jobID": "ec5731fe-7e97-44df-8c14-e2b9585338cb","index": 3}]}},{"page_item_url": "question-c0807f54-765e-4ad9-b19d-783a881d2c4f","data": {"jAScreeningQuestionID": "c0807f54-765e-4ad9-b19d-783a881d2c4f","jobID": "ec5731fe-7e97-44df-8c14-e2b9585338cb","question": "Where do you live?","isMandatory": true,"isMultiSelect": false,"answerType": "Text","index": 4,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc"}},{"page_item_url": "question-98545d42-f6bb-4144-a448-a3a875a7ed33","data": {"jAScreeningQuestionID": "98545d42-f6bb-4144-a448-a3a875a7ed33","jobID": "ec5731fe-7e97-44df-8c14-e2b9585338cb","question": "Select any of the following","isMandatory": true,"isMultiSelect": true,"answerType": "List","index": 5,"siteID": "1f654fc9-5dfd-4a5c-a54f-33d494cb26cc","jascreeningquestionanswer": [{"jAScreeningQuestionAnswerID": "fe943c67-bee2-4de3-b26a-681a0357a742","sort": 1,"value": "Two","jobID": "ec5731fe-7e97-44df-8c14-e2b9585338cb","index": 5},{"jAScreeningQuestionAnswerID": "d2420fd9-e18d-4666-8d33-c0acd70be66b","sort": 2,"value": "Three","jobID": "ec5731fe-7e97-44df-8c14-e2b9585338cb","index": 5},{"jAScreeningQuestionAnswerID": "a1c01923-9d11-463a-8090-f4206045d36f","sort": 0,"value": "One","jobID": "ec5731fe-7e97-44df-8c14-e2b9585338cb","index": 5}]}}]'))||
shazamme.fetch(v.questions)).then(b=>Promise.resolve(b?.filter(c=>r&&!p||c.data.jobID===p))).then(b=>{0<b?.length&&(e._pages[0]||(e._pages[0]=[]),e._pages[0]=e._pages[0].concat(b.map(c=>c.data)));a()})});this._showQuestions=(a,b=!0)=>{if(a>this.pageNumber&&!q())alert("Please answer all questions");else{this._recordAnswers();a>this._maxPage&&(this._maxPage=a);var c=(this._pages[a]||[]).filter(d=>!d.parentQuestionID||e._answers[d.parentQuestionID]).map(d=>e._questionEl({...d,options:d.jascreeningquestionanswer?.filter(h=>
!d.parentQuestionID||0<=e._answers[d.parentQuestionID].answerUUID?.indexOf(h.parentOptionID))||[]}));g.empty().append(c).append(e._pagingElements(a));g.find(".sq-help-text[collapsible]").each(function(d,h){let f=$(h);d=$(f).outerHeight();f.find(".text-main").attr("style",`--shaz-help-text-lines: ${k.helpTextLines||3}`);if(f.outerHeight()<d)f.addClass("collapsible").on("click","[data-rel=button-show-more]",function(){$(this);f.hasClass("expanded")?(f.find(".text-main").css({display:"-webkit-box"}),
f.removeClass("expanded")):(f.find(".text-main").css({display:"block"}),f.addClass("expanded"))})});g.find("[data-rel=screening-page-index]").click(function(){let d=parseInt($(this).attr("data-page"))||0;e._showQuestions(d)});if(this._pages[a]?.find(d=>d.parentQuestionID))g.find("input, select").on("change",function(){e._recordAnswers();e._showQuestions(a,!1)});g.find("[data-rel=screening-apply]").click(function(){q()?shazamme.pub(n.submit):alert("Please answer all questions")});b&&(g.get(0).scrollIntoView(),
window.scrollBy({top:-200,behavior:"smooth"}));this._restoreAnswers();this.pageNumber=a}};this._questionEl=a=>{switch(a.answerType){case "Text":return`
                             <div class="input-field-container">
                                <label class="text ${a.isMandatory?"required":""}">
                                    ${a.question}
                                </label>
                                <div class="sq-help-text" ${a.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${a.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${k.readMoreAlign}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${k.showMoreHelpText}</a>
                                    </div>
                                </div>
                                <input class="sq-input-text-style" type="text" maxlength=${a.length||-1} autocomplete="nope" data-qtype="text" data-qid="${a.jAScreeningQuestionID}" ${a.isMandatory?"required":""} />
                            </div>
                        `;case "List":let b=a.options.map(c=>`<label class="sq-question-option"><input type="${a.isMultiSelect?"checkbox":"radio"}" name="${a.jAScreeningQuestionID}" data-qtype="${a.isMultiSelect?"check-list":"radio"}" data-qid="${a.jAScreeningQuestionID}" data-value="${c.jAScreeningQuestionAnswerID}" ${a.isMandatory?"required":""} />${c.value}</label>`);return`
                             <div class="input-field-container">
                                <label class="text ${a.isMandatory?"required":""}">
                                    ${a.question}
                                </label>
                                <div class="sq-help-text" ${a.isHelpTextCollapse?"collapsible":""}>
                                    <p class="text-main">${a.helpText||""}</p>
                                    <div class="section-read-more" style="text-align: ${k.readMoreAlign}">
                                        <a href="javascript: void(0);" class="button-show-more" data-rel="button-show-more">${k.showMoreHelpText}</a>
                                    </div>
                                </div>
                                ${b.join("")}
                             </div>
                        `;default:return""}};this._pagingElements=a=>{let b=[];b.push("<div data-rel='screening-pages' class='screening-pages-container'>");0<a&&b.push(`<a href='javascript:void(0);' class="button-page-nav back" data-rel='screening-page-index' data-page='${a-1}'>Back</a>`);0<this._pages.length&&a<this._pages.length-1?b.push(`<a href='javascript:void(0);' class="button-page-nav forward" data-rel='screening-page-index' data-page='${a+1}'>Next</a>`):k.showApply&&b.push("<a href='javascript:void(0);' class=\"button-page-nav forward apply\" data-rel='screening-apply'>Apply</a>");
if(1<this._pages.length){let c=Array(this._maxPage+1);for(let d=0;d<c.length;d++)c[d]=`<a href='javascript:void(0);' class="button-page-index ${d===a?"active":""}" data-rel='screening-page-index' data-page='${d}'></a>`;for(a=c.length;a<this._pages.length;a++)c[a]="<a href='javascript:void(0);' class=\"button-page-index disabled\"></a>";b.push(`<div class="sq-pages-index">${c.join("")}</div>`)}b.push("</div>");return b.join("")};this._presentList=a=>{a.map(b=>`
                    <div>
                        <input type="checkbox" data-value="${b.value}" />
                        ${b.label||b.option}
                    </div>
                `);a=`
                    <div data-rel="dialog-answer-list">
                        <div class="list-options">${ops.join("")}</div>
                        <input type="button">OK</button>
                    </div>
                `;$(a).appendTo($(element))};this._recordAnswers=()=>{g.find("input, select").each((a,b)=>{let c=$(b);switch(c.attr("data-qtype")){case "text":e._answers[c.attr("data-qid")]={jobAppJaSqID:shazamme.uuid(),jAScreeningQuestionID:c.attr("data-qid"),answer:c.val()};break;case "radio":case "check-list":a=c.attr("data-qid");b=e._answers[a]?.listAnswers||[];if(c.is(":checked"))0>b.indexOf(c.attr("data-value"))&&b.push({jAScreeningQuestionAnswerID:c.attr("data-value")});else{let d=b.find(h=>
h.jAScreeningQuestionAnswerID===c.attr("data-value"));d&&b.splice(b.indexOf(d),1)}0===b.length?delete e._answers[c.attr("data-qid")]:e._answers[a]={jobAppJaSqID:shazamme.uuid(),jAScreeningQuestionID:c.attr("data-qid"),listAnswers:b}}})};this._restoreAnswers=()=>{for(let a in e._answers){let b=e._answers[a];a=a.split(":")[0];let c=g.find(`input[data-qid=${a}]`);switch(c.attr("data-qtype")){case "text":case "number":case "date":c.val(b.answer);break;case "bool":c.attr("checked",!0);break;case "list":case "check-list":case "radio":b.listAnswers?.forEach(d=>
{g.find(`input[data-qid=${a}][value=${d.jAScreeningQuestionAnswerID}]`).attr("checked",!0);g.find(`select[data-qid=${a}]`).val(d.jAScreeningQuestionAnswerID)})}}};this._readFile=a=>new Promise(b=>{let c=new FileReader;c.addEventListener("load",()=>{b(btoa(c.result))},!1);c.readAsBinaryString(a)});this._fileBlob=(a,b="",c=512)=>{a=atob(a);const d=[];for(let f=0;f<a.length;f+=c){var h=a.slice(f,f+c);const t=Array(h.length);for(let m=0;m<h.length;m++)t[m]=h.charCodeAt(m);h=new Uint8Array(t);d.push(h)}return new Blob(d,
{type:b})};u.log("Loading plugin: screening-question-job-adder (1.0.0)");shazamme.bag("plugin-screening-question-job-adder",{message:n,version:"1.0.0"});return this._fetchQuestions().then(()=>{this._showQuestions(0,!1);return Promise.resolve({nextPage:w,prevPage:x,answers:y,loadAnswers:z,knockout:A,container:g,validate:q,message:n,version:"1.0.0"})})}}})();